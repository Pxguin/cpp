# Codeforces Round 875 (#1830)

## C. Hyperregular Bracket Sequences
I'll define the number of bracket sequences of length $N$ as $B(N)$. If $N$ is even, then it's $C_{N/2}$, or the $(N/2)th$ Catalan number. If $N$ is odd then there are $0$ possibilities. 

Add $[1,N]$ as a range. Define the number of units that don't overlap with another range as $D$, and so the number of units that overlap equals $N-D$. The $D$ and $N-D$ units can be treated independently, as when any two ranges (that both must be RBS's) intersect, the intersection must also be an RBS. So basically, the intersection and the leftover sections from each range can be dealt with independently. So for the $[1,N]$ range, we can create any of the $B(D)$ bracket sequences with the $D$ units, and then multiply that by the total amount of bracket sequences made from the $N-D$ units (These units can be formed of many distinct ranges that each have to be RBS's, so it doesn't necessarily equal $B(N-D)$. But we can do this with $D$ because all $D$ units must be part of a single bracket sequence, which we can intersperse with the bracket sequences formed by the $N-D$ units). This gives us a general formula: for a given range with $D$ overlapped units, we multiply by $B(D)$.

If we sweep over the endpoints of all initial ranges, then each unique range is equal to the intersection of a unique set of active ranges at some point. $D$ for this range is equal to the sum of units in which the set of active ranges exactly equals the set whose intersection is this range. Note we don't explicitly need to find each range/intersection, because a unique set of active ranges produces a unique range. So all we need to know is the frequency of every set of ranges. To speed this up, we can hash all these sets with XOR hashing (assign a random num for each of the $K+1$ ranges). Then the answer is the product of all $B(D)$ over all the sets (ranges) we discover, and the runtime is $O(N+K)$.