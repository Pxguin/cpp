# Codeforces Round 988 (#2037)

## G. Natlan Exploring
Say that $dp[i]$ = the amount of ways to get to city $i$. $dp[0]=1$ as a base case. Then, $dp[i]$ is the sum of all $dp[j]$ such that $j<i$ and $gcd(a_i,a_j)\ne{1}$. If we denote the set of unique primes for $a_i$ as $S_i$, then $S_i\cap{S_j}\ne{\set{}}$. Therefore, find the primes for $a_i$ in $O(log\ {a_i})$ time. If we have decomposed all other $a_j$ into their prime factors, then just use inclusion-exclusion on the set of primes to find the total sum of $dp[j]$.

For example: assume the set of primes for index $i$ is $\set{2,3}$. Define an array $d$ such that $d[x]$ is equal to the sum of all $dp[j]$ satisfying $j<i$ and $a_j\equiv{0}\mod{x}$ ($x$ divides $a_j$). $dp[i]=d[2]+d[3]-d[2*3]$ by PIE. After this, update $d[x]$ with the divisors of $a_i$ in $O(\sqrt{a_i})$.

Altogether, the runtime becomes $O(N(logM+\sqrt{M}))$ where $M=\max{a_i}$.